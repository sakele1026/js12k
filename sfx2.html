<!doctype html>
<button id="music1">stop music</button>
<script src="TinyMusic.min.js"></script>
<script>

// create a new Web Audio API context
var ac = new AudioContext();

music_low1 = new TinyMusic.Sequence(ac, 100, [
  'B2 q',
  '- q',
  'Db3 q',
  '- q',
  'D3 q',
  '- q',
  'Gb3 q',
  'Bb3 q',
  'B2 q',
  '- q',
  'Db3 q',
  '- q',
  'D3 q',
  '- q',
  'Gb3 q',
  'B2 q',
  'B2 q',
  '- q',
  'Db3 q',
  '- q',
  'D3 q',
  '- q',
  'Gb3 q',
  'Bb3 q',
  'B2 q',
  '- q',
  'Db3 q',
  '- q',
  'D3 q',
  '- q',
  'Gb3 q',
  'B2 q',
  '- 32'
]);

music_mid1 = new TinyMusic.Sequence(ac, 100, [
  '- w',
  '- h',
  'D3 q',
  'Db3 q',
  '- w',
  '- h',
  'D3 q',
  'Gb3 q',
  '- w',
  '- h',
  'D3 q',
  'Db3 q',
  '- w',
  '- h',
  'D3 q',
  'Gb3 q',
  '- 32'
]);

music_hig1 = new TinyMusic.Sequence(ac, 100, [
  'B4 e',
  '- e',
  'Bb4 e',
  '- e',
  'A4 s',
  'A4 s',
  'Ab4 e',
  'G4 e',
  '- e',
  'Gb4 s',
  'B4 s',
  'Gb4 e',
  'D4 e',
  'B3 e',
  'D4 e',
  '- e',
  'Db4 e',
  '- e',
  'B4 e',
  '- e',
  'Bb4 e',
  '- e',
  'A4 s',
  'A4 s',
  'Ab4 e',
  'G4 e',
  '- e',
  'Gb4 s',
  'B4 s',
  'Gb4 e',
  'D4 e',
  'B3 e',
  'D4 e',
  'Db4 e',
  'B3 e',
  '- e',
  'B4 e',
  '- e',
  'Bb4 e',
  '- e',
  'A4 s',
  'A4 s',
  'Ab4 e',
  'G4 e',
  '- e',
  'Gb4 s',
  'B4 s',
  'Gb4 e',
  'D4 e',
  'B3 e',
  'D4 e',
  '- e',
  'Db4 e',
  '- e',
  'B4 e',
  '- e',
  'Bb4 e',
  '- e',
  'A4 s',
  'A4 s',
  'Ab4 e',
  'G4 e',
  '- e',
  'Gb4 s',
  'B4 s',
  'Gb4 e',
  'D4 e',
  'B3 e',
  'D4 e',
  'Db4 e',
  'B3 e',
  '- e',
  '- 32'
]);

music_low1.loop = true
music_low1.gain.gain.value = 0.4
music_low1.staccato = 0.5
music_low1.waveType = 'sine'

music_mid1.loop = true
music_mid1.gain.gain.value = 0.4
music_mid1.staccato = 0.5
music_mid1.waveType = 'sine'

music_hig1.loop = true
music_hig1.staccato = 0.5
music_hig1.gain.gain.value = 0.4

music_low2 = new TinyMusic.Sequence(ac, 100, [
  '- 32',
  'G3 e',
  'E3 e',
  'D3 e',
  'C3 e',
  'A2 e',
  'G2 e',
  'C2 e',
  'Bb2 e',
  'B2 e',
  'Db3 e',
  'D3 e',
  'E3 e',
  'Gb3 e',
  'G3 e',
  'Gb3 e',
  'Bb2 e',
  'G3 e',
  'E3 e',
  'D3 e',
  'C3 e',
  'A2 e',
  'G2 e',
  'C2 e',
  'Bb2 e',
  'B2 e',
  'Db3 e',
  'D3 e',
  'E3 e',
  'D3 e',
  'Db3 e',
  'B2 e',
  '- e',
  'G3 e',
  'E3 e',
  'D3 e',
  'C3 e',
  'A2 e',
  'G2 e',
  'C2 e',
  'Bb2 e',
  'B2 e',
  'Db3 e',
  'D3 e',
  'E3 e',
  'Gb3 e',
  'G3 e',
  'Gb3 e',
  'Bb2 e',
  'G3 e',
  'E3 e',
  'D3 e',
  'C3 e',
  'A2 e',
  'G2 e',
  'C2 e',
  'Bb2 e',
  'B2 e',
  'Db3 e',
  'D3 e',
  'E3 e',
  'D3 e',
  'Db3 e',
  'B2 e',
  '- e'
]);

music_mid2 = new TinyMusic.Sequence(ac, 100, [
  '- 32',
  'G4 w',
  'Gb4 w',
  'G4 w',
  'Gb4 w',
  'G4 w',
  'Gb4 w',
  'G4 w',
  'Gb4 w'
]);

music_hig2 = new TinyMusic.Sequence(ac, 100, [
  '- 32',
  'C4 w',
  'D4 w',
  'C4 w',
  'D4 w',
  'C4 w',
  'D4 w',
  'C4 w',
  'D4 w'
]);

music_low2.gain.gain.value = 0.6
music_low2.staccato = 0.5
music_low2.waveType = 'sine'

music_mid2.gain.gain.value = 0
music_hig2.gain.gain.value = 0

fade = 1
direction = 'up'

setInterval(function() {
  if (direction === 'up') {
    fade += 1;
    if (fade > 9) {
      direction = 'down'
      fade -= 1;
    }
  }

  if (direction === 'down') {
    fade -= 1;
    if (fade < 1) {
      direction = 'up'
      fade += 2;
    }
  }

  console.log(fade)

  music_mid2.gain.gain.value = fade * 0.01
  music_hig2.gain.gain.value = fade * 0.01
}, 300)

music_low1.play()
music_mid1.play()
music_hig1.play()
music_low2.play()
music_mid2.play()
music_hig2.play()


document.getElementById('music1').addEventListener('click', function() {
  music_low1.stop()
  music_mid1.stop()
  music_hig1.stop()
  music_low2.stop()
  music_mid2.stop()
  music_hig2.stop()
});

</script>
